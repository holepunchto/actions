name: Keet Automation

inputs:
  GITHUB_TOKEN:
    type: string
    description: "from secrets.GITHUB"
    required: true
  seed:
    type: string
    description: "seed for the automation"
    required: true
  remote:
    type: string
    description: "remote key for the automation"
    required: true
  job:
    type: string
    description: "job to run"
    required: true
  commit:
    type: string
    description: "commit"
    required: true
  channel:
    type: string
    description: "channel"
    required: true
  notify:
    type: string
    description: 'notify'
    required: false
    default: 'true'
  dry-run:
    type: string
    description: 'dry run'
    required: false

runs:
  using: composite
  steps:
    - name: Install keet-automation
      env:
        NODE_AUTH_TOKEN: ${{ inputs.GITHUB_TOKEN }}
      shell: bash
      run: |
        npm install -g @holepunchto/keet-automation

    - name: Build
      shell: bash
      run: |
        keet-automation \
          --seed ${{ inputs.seed }} \
          --remote ${{ inputs.remote }} \
          ${{ inputs.job }} \
          --commit ${{ inputs.commit }} \
          --channel ${{ inputs.channel }} \
          --notify ${{ inputs.notify }} \
          ${{ inputs.dry-run == 'true' && '--dry-run' || '' }} \
